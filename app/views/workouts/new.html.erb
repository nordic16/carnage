<script>
  function displayModal() {
      const dialog = document.getElementById('dialog');
      dialog.showModal();
  }

  function closeModal() {
      const dialog = document.getElementById('dialog');
      dialog.close();
  }

  function addExercises() {
    closeModal();
    var dialog = document.getElementById('dialog');
    
    var list = document.getElementById('ex_list');
    var choices = document.getElementsByName('ex_choice');

    var i, checkbox, node, li;
    for(i = 0; i < choices.length; i++) {
      var elem = choices[i];
       // this is some of the worst code i've ever written.... but hey, it works!
      if(elem.firstChild.nextSibling.nextSibling.nextSibling.checked) {
        li = document.createElement('li');
        li.setAttribute("class", "ml-4 ")
        
        node = document.createTextNode(choices[i].firstChild.nextSibling.textContent);

        li.appendChild(node);
        ex_list.appendChild(li);
      }
    }
  }
</script>

<div class="md:container p-4 mx-auto">
  <p class="text-4xl font-extrabold text-slate-100 mb-3">New workout</p>
  
    <%= form_with model: @workout do |form|  %>
      <div class="grid grid-cols-2 grid-flow-col relative">
        <dialog id="dialog" class="bg-zinc-950 p-5 rounded-2xl w-1/3">
          <div class="flex justify-between">
            <p class="text-slate-100 text-3xl font-extrabold">Add Exercise</p>
            <button type="button" onclick="closeModal();" class="font-bold text-red-500">x</button>
          </div>
          <p class="text-slate-100 font-bold">You may only select one.</p>
          <br>
          <%= form.collection_check_boxes :exercise_ids, Exercise.all, :id, :name, {multiple: true}, { class: " text-blue-400 w-full bg-zinc-950" } do |f| %>
            <div name="ex_choice" class="text-slate-100">
              <p id="ex_name"><%= f.text %></p>
              <%= f.check_box %>
            </div>
          <% end %>
          <button type="button" onclick="addExercises();" class="text-slate-100 mt-3 bg-blue-400 w-full rounded-lg">Add exercises</button>
        </dialog>
        <div>
          <p class="text-slate-100 text-xl font-bold">Title</p>
          <%= form.text_field :title, class: "text-3xl font-bold text-slate-100 bg-zinc-900 rounded-2xl"%><br>

          <p class="text-slate-100 text-xl font-bold">Description</p>
          <%= form.text_field :description, class: "text-3xl font-bold text-slate-100 bg-zinc-900 rounded-2xl"%><br> 
        </div>

        <div class="bg-slate-100 p-4 rounded-lg">
          <p class="text-2xl text-gray-700 font-bold">Exercises</p>
          <ul id="ex_list" class="list-disc text-gray-700">
          </ul>
        </div>
      </div>

      <div class="flex flex-row gap-5 justify-center mt-6">
        <%= form.submit class: "text-slate-100 text-xl font-bold px-4 mt-3 py-1 bg-red-500 rounded-lg" %>
        <button type="button" onclick="displayModal();" class="bg-blue-400 text-slate-100 text-xl font-bold px-4 mt-3 py-1 rounded-lg">Add Exercise</button>
      </div>
    <% end %>
</div>
